<%= content_for :javascript do %>
  <script type="text/javascript">
    // {
  //     "utf8" => "✓",
  //     "_method" => "patch",
  //     "authenticity_token" => "ifJnERfYkfYXav91zDHrDC6YAx+7y86lcNXeey3B77M=",
  //     "user" => {
  //       "email" => "aksjdfkhjasdkhj@aksjdfkhjasdkhj.com",
  //       "profile_attributes" => {
  //         "first_name" => "xxMike",
  //         "last_name" => "Hall",
  //         "bio" => "aljsdf asldkfj alskjf asdflkj asdljf lajskfdj alsjfljas lfdjlasj dflj sdflj asfljfdljaks dl",
  //         "interests" => "asd, asdf, fasdf, sadjk",
  //         "homepage" => "",
  //         "twitter" => "",
  //         "address" => "32 Bryant Court, Crystal Lake, IL",
  //         "id" => "87474494-b001-4e06-bf7f-183a5ad278c8"
  //       }
  //     },
  //     "commit" => "Save Profile",
  //     "action" => "update",
  //     "controller" => "profiles",
  //     "id" => "aksjdfkhjasdkhj"
  // }
  //
  //
  // <form accept-charset="UTF-8" action="&#47;profiles&#47;aksjdfkhjasdkhj" class="simple_form edit_user" id="edit_user" method="post" novalidate="novalidate">
  // <div style="display:none">
  // <input name="utf8" type="hidden" value="&#x2713;" />
  // <input name="_method" type="hidden" value="patch" />
  // <input name="authenticity_token" type="hidden" value="ifJnERfYkfYXav91zDHrDC6YAx+7y86lcNXeey3B77M=" />
  // </div>


  $(document).ready(function () {
    $('#user_profile_attributes_twitter').change(function (event) {
      event.preventDefault();

      var my = $(this);

      var myForm = my.parents('form');
      var myRoot = myForm.data('root');
      var myUrl = myForm.data('url');

      var data = {
        "utf8": "✓",
        "_method": "patch",
        "authenticity_token": null,
        "action": null,
        "controller": null,
      };

      data[myRoot] = {};
      data["controller"] = myForm.data("controller");
      data["action"] = myForm.data("action");
      data["authenticity_token"] = myForm.find('input[name=authenticity_token]').val();
      data[myRoot][my.data("field-name")] = my.val();

      var request = $.ajax({
        url: myUrl,
        data: data,
        type: 'PATCH',
        cache: true,
        crossDomain: false,
        dataType: 'json',
        context: my
      });

      request.done(function (data, textStatus, jqXHR) {
        var my = $(this[0]);
        var field = data[myRoot][my.data("field-name")];
        if (field) {
          my.removeClass('error');
          my.val(field[my.data("field-value")]);
        } else {
          my.addClass('error');
          my.val(null);
        }
      });

      request.fail(function (jqXHR, textStatus, errorThrown) {
        var my = $(this[0]);
        my.addClass('error');
        <%- unless Rails.env.production? -%>
          console.log(my);
          console.log(jqXHR);
          console.log(textStatus);
          console.log(errorThrown);
          console.log('FAIL');
        <%- end -%>
      });
    });
  });
  </script>
<% end %>

<%= simple_form_for(@user, as: :user, url: '#', html: { 'data-controller' => 'profile', 'data-action' => 'update', 'data-root' => 'profile', 'data-url' => profile_path(@user) }) do |f| %>
  <%= field_set_tag 'Account Info' do %>
    <%= f.input :username, disabled: true, enabled: false, hint: "Send an email to <a href=\"mailto:support@ugl.st?subject=Change the account name for ID: #{@user.id}&body=Please change account name from '#{@user.username}' to _______.\">support</a> to change your username.".html_safe %>
    <%= gravatar_image_tag(@user.email, alt: @user.profile.full_name, alt: @user.profile.full_name, id: 'gravatar', class: '') %>
    <%= f.input :email %>
  <% end %>

  <%= f.simple_fields_for :profile do |profile_fields| %>
    <%= field_set_tag 'Public Info' do %>
      <%= profile_fields.input :first_name %>
      <%= profile_fields.input :last_name %>
      <%= profile_fields.input :bio %>
      <%= profile_fields.input :interests, input_html: {value: safe_join(@user.profile.interests || [], ', ')}, as: :string %>
      <p class="help-block">Comma separated list of interests.</a>
    <% end %>

    <%= field_set_tag 'Online Info' do %>
      <%= profile_fields.input :homepage, placeholder: 'http://www.example.com' %>
      <%= profile_fields.input :twitter, placeholder: '@ugtastic', input_html: { value: @user.profile.twitter && @user.profile.twitter.screen_name, 'data-field-name' => 'twitter', 'data-field-value' => 'screen_name' } %>
    <% end %>

    <%= field_set_tag 'Geographic Info' do %>
      <%= profile_fields.input :address, required: true, placeholder: '614 18th Ave Menlo Park, CA 94025', hint: 'As much of the address as you know. Please provide at least the city, state/region/provice, and country.', as: :string %>
    <% end %>
  <% end %>

  <!--
  <%= field_set_tag 'Personal Info' do %>
    <div class='bs-callout bs-callout-warning'>
      <strong>Why are we asking for this information?</strong>

      <p>In a nutshell this data can help to build a better understanding of people as they are represented in the
        technical community.</p>

      <p>You are free to fill in as little or as much as you are comfortable sharing. The presence of this information
        will have no negative </p>

      <p>This information is stored in encrypted fields and is marked to be excluded from logging and New Relic. We
        strive to protect your sensitive data and appreciate your trust.</p>

      <p>If you have any questions or concerns about how we collect and store private data feel free to
        <a href="mailto:mike+privacy@ugl.st">contact us</a>.</a>
    </div>
    <%= f.simple_fields_for :personal do |personal_fields| %>
      <%= personal_fields.input :birthday, class: 'datepicker form-control', 'data-behaviour' => 'datepicker', placeholder: 'MM/DD/YYYY', as: :string %>
      <%= personal_fields.input :gender, hint: 'Please provide the gender you identify as.', as: :string %>
      <%= personal_fields.input :parental_status, as: :string %>
      <%= personal_fields.input :ethnicity, as: :string %>
      <%= personal_fields.input :race, as: :string %>
      <%= personal_fields.input :relationship_status, as: :string %>
      <%= personal_fields.input :sexual_orientation, as: :string %>
      <%= personal_fields.input :religious_affiliation, as: :string %>
    <% end %>
  <% end %>
  -->
<% end %>

<%= content_for :javascript do %>
  <script type="text/javascript">
    $(document).ready(function () {
      $('.datepicker').datepicker();
      $('#user_email').blur(function () {
        var gravatar_url = 'https://secure.gravatar.com/avatar/' + md5($('#user_email').val()) + '?default=identicon&amp;secure=true';
        $('#gravatar').attr('src', gravatar_url);
      });
    });
  </script>
<% end %>

